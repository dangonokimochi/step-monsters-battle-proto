# CLAUDE.md - Step Monsters Battle MVP

## プロジェクト概要

Step Monstersの戦闘システムMVPプロトタイプ。
「散歩×モンスター収集×グリッドSRPG×ローグライト」ゲームの戦闘部分を検証する。

**目的：戦闘が面白いかを高速に検証する。完成度より検証速度を優先。**

## 技術スタック

- React + TypeScript
- Vite（ビルドツール）
- CSS Modules or Tailwind（スタイリング）
- Canvas API or DOM（盤面描画）

## ディレクトリ構成

```
step-monsters-battle-proto/
├── CLAUDE.md              # このファイル。Claude Codeへの指示
├── README.md              # プロジェクト概要
├── battle-mvp-spec.md     # 戦闘MVPの詳細仕様
├── game-design-draft.md   # ゲーム全体の設計書（参照用）
├── src/
│   ├── data/              # モンスター・スキルのデータ定義
│   ├── engine/            # 戦闘ロジック（ターン管理、ダメージ計算、射線判定、AI）
│   ├── components/        # UIコンポーネント（盤面、ユニット、HUD）
│   ├── types/             # TypeScript型定義
│   └── App.tsx
├── public/
└── package.json
```

## 開発ルール

### 最重要原則

1. **検証速度優先**。美しいコードより動くプロトタイプ。
2. **戦闘ロジック（engine/）とUI（components/）を分離**する。ロジックはUIに依存しない。将来的にUnity/Godotに移植する可能性があるため。
3. **データ駆動**。モンスター・スキルのデータはJSONまたはTSオブジェクトで定義し、コードにハードコードしない。
4. **各ステップごとにプレイ可能な状態を維持**する。壊れた中間状態を作らない。

### コーディング規約

- TypeScript strict mode
- 関数コンポーネント + hooks
- 状態管理はuseReducerベース（戦闘状態が複雑なため）
- コメントは日本語OK
- ファイル名はkebab-case

### Git運用

- mainブランチで直接作業（MVP段階ではブランチ不要）
- コミットメッセージは日本語OK
- ステップごとにタグを打つ（v0.1-grid, v0.2-turn, etc.）

## 戦闘システム概要（クイックリファレンス）

詳細は `battle-mvp-spec.md` を参照。

### 基本ルール
- 6×4グリッド。陣営区別なし。自由配置・自由移動
- SPD順に1体ずつ行動
- 1ターン1行動（攻撃/スキル/アイテム使用）
- 移動は行動とは別にMOVを消費して実行
- 防御なし、逃走なし
- 勝利：敵全滅 / 敗北：味方全滅

### ステータス
- HP, ATK, DEF, SPD, MP, EVA（個体値あり）
- MOV（モンスター種ごとの固定値、個体値なし）

### 攻撃サブ属性（技ごとに設定）
- 射程：近接（隣接マス）/ 遠距離（数マス先）
- 射線貫通：あり / なし
- 防御貫通率：0%〜100%

### ダメージ計算
```
ダメージ = ATK × (100 / (100 + DEF × (1 - 防御貫通率)))
```

### 地形
- 戦闘ごとにランダム配置
- 岩（侵入不可・射線遮蔽）、水たまり（MOV+1消費）、茂み（直射対象外）、高台（射程+1）

### 初期配置
- 味方：盤面の左半分（列0〜2）に自由配置
- 敵：盤面の右半分（列3〜5）に配置

## 開発ステップ

各ステップ完了時にプレイ可能な状態にすること。

### Step 1: データ定義 + 盤面描画
- モンスター・スキルの型定義とサンプルデータ
- 6×4グリッドの描画
- モンスターの配置表示

### Step 2: 移動の実装
- MOV範囲のハイライト表示
- タップで移動
- 地形による移動制限

### Step 3: ターン制 + 行動選択
- SPD順のターン管理
- 通常攻撃・スキル選択UI
- ダメージ計算と適用

### Step 4: 射線・射程の実装
- 近接/遠距離・直射/遠距離・間接の判定
- 射線遮蔽の判定（間のユニット・岩による遮蔽）
- 到達可能な攻撃対象のハイライト

### Step 5: 地形の追加
- ランダム地形配置
- 各地形効果の実装

### Step 6: 敵AI
- 普通の強さのAI（弱すぎるとテストにならない）
- 移動→攻撃の判断ロジック

### Step 7: UI/UX調整
- カメラ制御（ターン時ズーム + 全体表示切替）
- HP/MPバー、ダメージ表示
- 戦闘結果画面

## 注意事項

- このプロトタイプはPDCA検証用。本番開発ではない。
- 戦闘が面白いかの検証が目的。ビジュアルの美しさは二の次。
- 仕様に迷ったら `battle-mvp-spec.md` を確認。それでも不明な場合は最もシンプルな実装を選ぶ。
